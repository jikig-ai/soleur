---
title: "feat: Community management agent and skill"
type: feat
date: 2026-02-18
---

# feat: Community management agent and skill

## Overview

Add a community management capability to Soleur: a community-manager agent for multi-step reasoning (monitoring, analysis, digests) and a community skill as the user-facing entry point. The agent orchestrates existing skills (discord-content, release-announce) and adds new capabilities via shell scripts for Discord Bot API and GitHub API access.

## Problem Statement

Soleur has write-only community tools (Discord webhooks, release CI) but no way to read community activity, analyze engagement, or generate digests. Other projects using Soleur have no community management capability at all.

## Proposed Solution

Two components following Soleur's architecture (skills = entry points, agents = brains):

1. **Community skill** (`skills/community/SKILL.md`) -- user invokes `/soleur:community <subcommand>`
2. **Community manager agent** (`agents/marketing/community-manager.md`) -- spawned by skill for complex workflows
3. **Shell scripts** (`skills/community/scripts/`) -- Discord Bot API and GitHub API wrappers

### Architecture

```
User --> /soleur:community <cmd> (skill)
              |
              +--> digest --> community-manager agent
              |                    |-> discord-community.sh (read messages)
              |                    |-> github-community.sh (read PRs/issues)
              |                    |-> writes knowledge-base/community/YYYY-MM-DD-digest.md
              |                    |-> posts condensed version to Discord via webhook
              |
              +--> health --> community-manager agent
              |                    |-> discord-community.sh (member count, activity)
              |                    |-> github-community.sh (issue/PR stats)
              |                    |-> displays metrics inline
              |
              +--> post --> informs user: "Use /soleur:discord-content <topic>"
              |             (skills cannot invoke other skills programmatically)
              |
              +--> welcome --> generates onboarding message, posts via webhook
```

Note: Skills are user-invoked only. The `post` sub-command cannot call discord-content programmatically -- it informs the user to invoke it directly.

## Technical Considerations

### Discord Bot API

- Requires `DISCORD_BOT_TOKEN` env var (not just webhook URL)
- Key endpoints: `GET /guilds/{id}/members`, `GET /channels/{id}/messages`, `GET /guilds/{id}`
- Rate limits: 50 requests/second per route. Daily batch analysis is well within limits.
- Bot needs `SERVER MEMBERS INTENT` and `MESSAGE CONTENT INTENT` permissions
- Messages endpoint returns max 100 per request, paginate with `before` parameter

### GitHub API

- Uses `gh` CLI (already authenticated in most Soleur setups)
- Key data: `gh api repos/{owner}/{repo}/issues`, `gh api repos/{owner}/{repo}/pulls`
- Discussions require GraphQL: `gh api graphql`

### Privacy

- Discord display names are public; include in digests
- Do not store message content verbatim -- summarize and aggregate
- Digest files go to `knowledge-base/community/` which may be committed to repo

### Platform Abstractions

- Shell scripts isolate platform-specific API calls
- Agent reasons about community concepts: "top contributors", "trending topics", "unanswered questions"
- Adding a new platform = new script + update agent to call it

## Implementation Phases

### Phase 1: Shell Scripts (Foundation)

Create `skills/community/scripts/` with two scripts.

**`discord-community.sh`** -- Discord Bot API wrapper (scoped to community operations)

```bash
# Usage: discord-community.sh <command> [args]
# Commands:
#   messages <channel_id> [limit] [after_date]  - Fetch messages
#   members [limit]                              - Fetch guild members
#   guild-info                                   - Fetch guild metadata
#   channels                                     - List guild channels
```

- Reads `DISCORD_BOT_TOKEN` and `DISCORD_GUILD_ID` from env
- Validates env vars exist and have valid format (bot token format, numeric guild ID) before any API call
- Outputs JSON to stdout
- Handles pagination for messages (loop with `before` param)
- Exits with non-zero on API error, stderr for error messages
- Detects HTTP 401 (expired/invalid token) and provides renewal instructions
- Detects HTTP 429 (rate limit) and retries with `Retry-After` header value

**`github-community.sh`** -- GitHub community data wrapper

```bash
# Usage: github-community.sh <command> [args]
# Commands:
#   activity [days]    - Recent issues, PRs, and comments
#   contributors [days] - Active contributors in period
#   discussions [days]  - Recent discussions (if enabled)
```

- Uses `gh` CLI (no separate auth needed)
- Auto-detects repo from git remote
- Outputs JSON to stdout
- Handles repos without Discussions enabled (graceful skip)

### Phase 2: Community Manager Agent

Create `agents/marketing/community-manager.md`.

**Frontmatter:**

```yaml
name: community-manager
description: "Use this agent when you need to analyze community engagement, generate weekly digests, or assess community health metrics. It reads Discord messages via bot API, fetches GitHub activity, and produces structured community reports. <example>Context: The user wants a weekly summary of community activity.\\nuser: \"Generate a community digest for this week\"\\nassistant: \"I'll use the community-manager agent to analyze Discord and GitHub activity and generate the digest.\"\\n<commentary>\\nDigest generation requires multi-step analysis across Discord and GitHub data, which is the core purpose of community-manager.\\n</commentary>\\n</example>\\n\\n<example>Context: The user wants to understand community health.\\nuser: \"How active is our community? Show me the metrics.\"\\nassistant: \"I'll launch the community-manager agent to gather health metrics from Discord and GitHub.\"\\n<commentary>\\nHealth metrics require aggregating data from multiple sources, making this an agent task rather than a simple lookup.\\n</commentary>\\n</example>"
model: inherit
```

**Agent capabilities:**

1. **Digest generation:**
   - Run `discord-community.sh messages` for each monitored channel (last 7 days)
   - Run `github-community.sh activity 7`
   - Analyze: message volume, top contributors, trending topics, unanswered questions
   - Generate markdown digest to `knowledge-base/community/YYYY-MM-DD-digest.md`
   - Check brand guide exists before generating Discord post (for brand voice alignment)
   - Generate condensed Discord version (under 2000 chars)
   - Post via `DISCORD_WEBHOOK_URL`

2. **Health metrics:**
   - Run `discord-community.sh guild-info` + `discord-community.sh members`
   - Run `github-community.sh activity 30` + `github-community.sh contributors 30`
   - Display: member count, 30-day message volume, avg response time, open issues, active PRs, top 5 contributors

3. **Content suggestions:**
   - Based on community activity, suggest topics for posts
   - Identify unanswered questions that need responses

**Digest file contract:**

Digest markdown files follow this heading contract for downstream consumers:

| Heading | Required | Purpose |
|---------|----------|---------|
| `## Period` | Yes | Date range (start -- end) |
| `## Activity Summary` | Yes | Message volume, contributor count, key stats |
| `## Top Contributors` | Yes | Most active community members |
| `## Trending Topics` | Optional | Most discussed topics |
| `## Unanswered Questions` | Optional | Questions needing response |
| `## GitHub Activity` | Optional | Issues, PRs, discussions during period |

Digest file naming convention: `YYYY-MM-DD-digest.md`

Digest frontmatter fields: `period_start`, `period_end`, `generated_at`, `channels_analyzed`

**Agent does NOT:**
- Post content without user approval (delegates to discord-content)
- Moderate or delete messages
- Store raw message content

### Phase 3: Community Skill

Create `skills/community/SKILL.md`.

**Frontmatter:**

```yaml
name: community
description: "This skill should be used when managing community engagement across Discord and GitHub. It provides sub-commands for generating weekly digests, checking community health, posting updates, and welcoming new members. Triggers on \"community digest\", \"community health\", \"community metrics\", \"weekly digest\", \"/soleur:community\"."
```

**Sub-commands:**

Structure each sub-command workflow as Phase sections per constitution convention.

1. **`/soleur:community digest`**
   - Phase 0: Check prerequisites (`DISCORD_BOT_TOKEN`, `DISCORD_GUILD_ID`, `DISCORD_WEBHOOK_URL`, brand guide)
   - Phase 1: Spawn community-manager agent for analysis and generation
   - Phase 2: Display digest file path and Discord post status

2. **`/soleur:community health`**
   - Phase 0: Check prerequisites (`DISCORD_BOT_TOKEN`, `DISCORD_GUILD_ID`)
   - Phase 1: Spawn community-manager agent for metrics
   - Phase 2: Display inline (no file output)

3. **`/soleur:community post <topic>`**
   - Inform user: "For posting content, use `/soleur:discord-content <topic>` directly."
   - Exit (skills cannot invoke other skills programmatically)

4. **`/soleur:community welcome`**
   - Phase 0: Check prerequisites (`DISCORD_WEBHOOK_URL`, brand guide)
   - Phase 1: Read brand guide `## Voice` and `## Channel Notes > ### Discord`
   - Phase 2: Generate welcome message for new members
   - Phase 3: User approval via AskUserQuestion
   - Phase 4: Post via webhook

**Prerequisites check pattern** (from discord-content skill):

```
Phase 0: Check env vars
  - Missing DISCORD_BOT_TOKEN -> show setup instructions, stop
  - Missing DISCORD_GUILD_ID -> show setup instructions, stop
  - Missing DISCORD_WEBHOOK_URL -> show setup instructions, stop (for commands that post)
```

### Phase 4: Version Bump and Documentation

- Bump version: MINOR (new skill + new agent)
- Update `plugin.json`, `CHANGELOG.md`, `README.md`
- Update root `README.md` badge
- Update `.github/ISSUE_TEMPLATE/bug_report.yml` placeholder

## Acceptance Criteria

- [ ] `discord-community.sh` fetches messages, members, and guild info from Discord Bot API
- [ ] `discord-community.sh` validates env var formats (bot token format, numeric guild ID, valid webhook URL)
- [ ] `github-community.sh` fetches issues, PRs, contributors, and discussions from GitHub
- [ ] Both scripts validate env vars and handle API errors gracefully (including malformed JSON, rate limits, expired tokens)
- [ ] Community manager agent generates a weekly digest as markdown following the digest file contract
- [ ] Digest files follow naming convention `YYYY-MM-DD-digest.md` with frontmatter (`period_start`, `period_end`, `generated_at`)
- [ ] Community manager agent posts condensed digest to Discord
- [ ] Community manager agent displays health metrics
- [ ] Community skill routes sub-commands correctly (digest, health, post, welcome)
- [ ] `post` sub-command informs user to use `/soleur:discord-content` (does not attempt programmatic skill invocation)
- [ ] Agent frontmatter includes `<example>` blocks with context/user/assistant/commentary
- [ ] Skill frontmatter uses third-person description
- [ ] Agent frontmatter includes `model` field
- [ ] Version bump updates all three files + root README badge + bug report template

## Test Scenarios

### Shell Scripts

- Given `DISCORD_BOT_TOKEN` is unset, when `discord-community.sh messages` runs, then exit 1 with error on stderr
- Given `DISCORD_BOT_TOKEN` has invalid format, when `discord-community.sh` runs, then exit 1 with format validation error
- Given valid credentials, when `discord-community.sh messages <channel> 10` runs, then output JSON array of messages
- Given a channel with 200+ messages, when fetching last 7 days, then paginate correctly (multiple API calls)
- Given Discord API returns HTTP 401, when any command runs, then display token renewal instructions and exit 1
- Given Discord API returns HTTP 429, when any command runs, then retry after `Retry-After` header value
- Given Discord API returns malformed JSON, when parsing response, then exit 1 with clear error message
- Given `gh` is not authenticated, when `github-community.sh activity` runs, then exit 1 with error
- Given a repo without Discussions, when `github-community.sh discussions` runs, then output empty array (no error)
- Given GitHub API rate limit is hit, when `github-community.sh` runs, then exit with actionable rate limit message

### Agent

- Given Discord data with 50 messages and 3 contributors, when digest is generated, then markdown file contains contributor list, trending topics, and message volume
- Given no messages in the period, when digest is generated, then digest notes "quiet week" rather than erroring
- Given digest file is written but webhook POST fails, when result is displayed, then show digest file path and offer manual posting instructions

### Skill

- Given missing `DISCORD_BOT_TOKEN`, when `/soleur:community digest` runs, then display setup instructions and stop
- Given all prerequisites met, when `/soleur:community digest` runs, then digest file is created and Discord post is sent
- Given user runs `/soleur:community post "weekly update"`, then inform user to use `/soleur:discord-content` directly
- Given `DISCORD_CHANNEL_IDS` is set with multiple channels, when digest runs, then fetch messages from all specified channels

## Dependencies and Risks

**Dependencies:**
- Discord Bot Token with appropriate permissions (MESSAGE_CONTENT, SERVER_MEMBERS intents)
- `gh` CLI authenticated for GitHub API access
- Brand guide at `knowledge-base/overview/brand-guide.md` (for digest Discord post and welcome commands)
- `DISCORD_CHANNEL_IDS` (optional): Comma-separated list of channel IDs to monitor. If unset, monitors all accessible text channels.

**Risks:**
- Discord Bot setup friction -- mitigate with clear setup instructions in skill prerequisites
- API rate limiting -- mitigate with daily batch approach, not real-time polling
- Large servers with high message volume -- mitigate with channel filtering (`DISCORD_CHANNEL_IDS`)

## Non-Goals

- Docs site community page (separate issue)
- Discord bot hosting (on-demand only)
- Moderation capabilities
- Social media integrations
- Real-time notifications
- GitHub Discussions adapter (v2)

## Rollback Plan

All changes are additive (new files only). Rollback = delete the new agent, skill, and scripts directories. No existing functionality is modified.

## Version Bump Intent

MINOR -- new skill and new agent.

## References

- Brainstorm: `knowledge-base/brainstorms/2026-02-18-community-agent-brainstorm.md`
- Spec: `knowledge-base/specs/feat-community-agent/spec.md`
- Existing pattern (skill with scripts): `skills/git-worktree/`
- Existing pattern (marketing agent): `agents/marketing/brand-architect.md`
- Existing pattern (Discord posting): `skills/discord-content/SKILL.md`
- Discord Bot API: https://discord.com/developers/docs/resources/channel#get-channel-messages
- Brand guide contract: `agents/marketing/brand-architect.md` (heading-level contract table)
