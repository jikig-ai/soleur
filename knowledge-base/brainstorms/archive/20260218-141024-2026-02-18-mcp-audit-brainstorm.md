# MCP Integration Audit -- Brainstorm

**Date:** 2026-02-18
**Issue:** #116
**Status:** Complete

## What We're Building

A prioritized assessment of all 28 agents and 37 skills in the Soleur plugin, identifying where HTTP MCP servers would add value over the current Bash/curl approach. The deliverable is this document -- a ranked list with rationale, not code.

## Why This Matters

PR #108 (GitHub Pages + Cloudflare wiring) exposed an "agent autonomy gap" where the infra-security agent needed 10+ manual round-trips for what should have been autonomous. The root cause: fragile curl-based API calls with text parsing in prompt logic. MCP tools could provide structured, typed responses that agents reason about more reliably.

## Methodology

**API-Surface-First:** Instead of reviewing each agent individually, we cataloged all external API surfaces across the entire plugin, then evaluated each surface for MCP viability. This deduplicates naturally -- a single Cloudflare MCP server benefits multiple agents.

**Constraint:** Only HTTP MCP servers are considered. Stdio servers can't be bundled in plugin.json and require separate IDE extension installation (documented in `knowledge-base/learnings/2026-02-14-pencil-mcp-local-binary-constraint.md`).

## Current State

### Already Using MCP (3 integrations)

| Integration | Transport | Bundled? |
|---|---|---|
| Context7 (documentation) | HTTP | Yes -- in plugin.json |
| Playwright (browser automation) | stdio | No -- IDE extension |
| Pencil (visual design) | stdio | No -- IDE extension |

### External API Surface Audit

| API Surface | Components | Current Method | MCP Viability | Priority |
|---|---|---|---|---|
| **Cloudflare REST API** | infra-security agent | curl via Bash, manual JSON parsing | **HIGH** | 1 |
| **DNS/SSL verification** | infra-security agent | dig, openssl, curl -sI via Bash | **MEDIUM** | 2 |
| **Discord Webhooks** | discord-content skill | Single curl POST | **LOW** | 3 |
| **GitHub API** | infra-security (Pages config), workflow skills | gh CLI with --json | **LOW** | 4 |
| **Google Gemini API** | gemini-imagegen skill | Python SDK scripts | **NONE** | - |
| **Hetzner/AWS APIs** | terraform-architect agent | Generates HCL only, never calls APIs | **NONE** | - |
| **Web search/fetch** | ops-research, researchers | Built-in Claude tools | **NONE** | - |
| **Rclone (S3/R2/etc)** | rclone skill | rclone CLI | **NONE** | - |

### Agents With No External API Dependencies (20 of 28)

All review agents (15), design agents (2), product agents (1), and research agents that only use built-in tools (2) have zero external API calls. They operate entirely on code, files, and git history. MCP adds no value here.

| Domain | Count | Agents |
|---|---|---|
| Engineering/Review | 15 | agent-native-reviewer, architecture-strategist, code-quality-analyst, code-simplicity-reviewer, data-integrity-guardian, data-migration-expert, deployment-verification-agent, dhh-rails-reviewer, kieran-rails-reviewer, legacy-code-expert, pattern-recognition-specialist, performance-oracle, security-sentinel, test-design-reviewer |
| Engineering/Design | 1 | ddd-architect |
| Engineering/Research | 4 | best-practices-researcher, framework-docs-researcher, git-history-analyzer, learnings-researcher |
| Engineering/Workflow | 1 | pr-comment-resolver |
| Product | 1 | spec-flow-analyzer |
| Operations | 1 | ops-advisor (reads/writes local markdown files only) |

Note: best-practices-researcher uses WebSearch/WebFetch and Context7 MCP -- these are already built-in Claude tools or bundled MCP servers.

## Detailed Assessment: High-Priority Candidates

### Priority 1: Cloudflare REST API (HIGH)

**Current pain:**
- infra-security agent constructs curl commands with headers, parses JSON text in prompt logic
- Error handling is ad-hoc (mapping Cloudflare error codes via prompt instructions)
- Multi-step workflows (GitHub Pages wiring) require sequential curl calls with state management
- The GitHub Pages wiring learning documents 5 sequential blockers that were hit due to this fragility

**What an MCP server would provide:**
- Typed CRUD tools: `list_dns_records`, `create_dns_record`, `update_dns_record`, `delete_dns_record`
- Zone management: `get_zone_settings`, `update_zone_setting`
- Security tools: `get_ssl_status`, `get_dnssec_status`
- Built-in token validation as connection handshake
- Structured JSON responses instead of text parsing

**Transport viability:** HTTP -- Cloudflare's API is REST, an MCP server wrapping it would be a thin HTTP proxy. Could be self-hosted or use a third-party Cloudflare MCP server if one exists.

**Existing community servers:** Check if cloudflare/mcp-server-cloudflare or similar exists on npm/GitHub.

**Impact:** Directly closes the "agent autonomy gap" from PR #108. Makes the 10-step GitHub Pages wiring recipe executable without fragile text parsing.

### Priority 2: DNS/SSL Verification (MEDIUM)

**Current pain:**
- `dig +short`, `dig +trace`, `openssl s_client` return unstructured text
- Agent must parse text output to extract meaningful data (IP addresses, cert expiry, chain validity)
- Results vary by platform (dig output differs between macOS and Linux)

**What an MCP server would provide:**
- `check_dns_propagation(domain, record_type)` returning structured JSON
- `verify_ssl_cert(domain)` returning issuer, expiry, chain status
- `check_http_headers(url)` returning parsed security headers

**Transport viability:** HTTP -- could wrap dig/openssl in a lightweight HTTP service, or use a DNS-over-HTTPS API directly.

**Counter-argument:** dig and openssl are industry-standard tools. Every infra engineer knows them. The text parsing is annoying but not broken. This is a "nice to have" -- Cloudflare MCP is the real win.

### Priority 3: Discord Webhooks (LOW)

**Current pain:** Minimal. Single curl POST with a JSON payload. Works reliably.

**What an MCP server would provide:** `post_message(channel, content, embeds)` -- slightly cleaner but the curl call is 3 lines and never fails.

**Verdict:** Not worth the overhead. curl is fine for single POST calls.

### Priority 4: GitHub API (LOW)

**Current pain:** Minimal. `gh` CLI already provides structured JSON output via `--json` flag. Well-documented, well-tested.

**What an MCP server would provide:** Marginal improvement at best. `gh` is essentially already an MCP-quality interface to GitHub's API.

**Verdict:** Not worth it. `gh` CLI is the right tool.

## Key Decisions

1. **Cloudflare is the only high-value MCP opportunity** -- everything else either already has MCP, has a good SDK/CLI, or is too simple to benefit.
2. **HTTP-only constraint eliminates most creative ideas** -- things like a "Terraform runner" MCP would need local execution (stdio), not HTTP.
3. **20 of 28 agents have no external API surface** -- they work on code and files, which Claude's built-in tools handle perfectly.
4. **The repo already has strong MCP design philosophy** (agent-native-architecture/references/mcp-tool-design.md) but zero custom implementation. This audit confirms there's only one clear place to start.

## Recommended Next Step

Investigate whether a Cloudflare MCP server already exists in the community (npm, GitHub). If yes, evaluate bundling it. If no, design one following the patterns in `mcp-tool-design.md`. This would be the scope of a follow-up plan.

## Open Questions

- Does a community Cloudflare MCP server exist that we could use directly?
- Should the DNS/SSL verification be part of the same MCP server or separate?
- Would a self-hosted MCP server (e.g., on Hetzner) be acceptable, or must it be a public HTTP endpoint?
