# Brainstorm: Persist Competitive Intelligence Report as Living Document

**Date:** 2026-03-02
**Status:** Complete
**Participants:** User, repo-research-analyst, learnings-researcher

## What We're Building

The competitive-intelligence agent already writes `knowledge-base/overview/competitive-intelligence.md` during scheduled GitHub Action runs, but the CI workspace is discarded after the workflow completes. The only persistent artifact is a GitHub Issue.

We're adding shell steps to the existing `scheduled-competitive-analysis.yml` workflow that commit the generated report to the repository via a PR, making it a living document that agents and humans can reference alongside `brand-guide.md` and `business-validation.md`.

## Why This Approach

**Approach A: Shell steps after Claude finishes** was selected over two alternatives:

- **vs. Approach B (Claude does the commit):** LLM doing git plumbing is flaky, harder to debug, and burns tokens on mechanical work. If Claude hits max-turns, the commit may not happen.
- **vs. Approach C (Separate workflow):** `GITHUB_TOKEN` cascade limitation means issue events from workflow 1 won't trigger workflow 2. Would need a PAT. Over-engineered.

Shell steps are deterministic, debuggable from Actions logs, and don't consume LLM tokens on git mechanics.

## Key Decisions

1. **Commit strategy:** Open a PR (branch protection rejects direct pushes to main). Auto-merge if clean; resolve conflicts autonomously.
2. **Conflict resolution:** New report always wins (`--strategy-option theirs`). The report is fully regenerated each run — there's no meaningful merge.
3. **GitHub Issue:** Keep creating issues alongside the file. Issue = notification + audit trail. File = latest state for agents. Different purposes.
4. **Permissions:** Workflow needs `contents: write` and `pull-requests: write` (currently has `contents: read`).
5. **Branch naming:** `ci/competitive-intel-YYYY-MM-DD` for the auto-PR branch.
6. **Motivation:** Both agents and humans benefit. Other agents (CPO, brand-architect) read context from `knowledge-base/overview/` — competitive intel should be there too.

## Open Questions

- Should the PR body reference the companion GitHub Issue number? (Likely yes, for traceability.)
- Should cleanup of stale `ci/competitive-intel-*` branches be handled? (Squash-merge deletes the branch automatically via GitHub settings.)

## Implementation Sketch

```yaml
# After claude-code-action step:
- name: Persist competitive intelligence report
  if: success()
  env:
    GH_TOKEN: ${{ github.token }}
  run: |
    FILE="knowledge-base/overview/competitive-intelligence.md"
    if [ ! -f "$FILE" ]; then
      echo "::warning::Report file not found, skipping persist step"
      exit 0
    fi
    BRANCH="ci/competitive-intel-$(date +%Y-%m-%d)"
    git checkout -b "$BRANCH"
    git add "$FILE"
    git commit -m "docs: update competitive intelligence report [skip ci]"
    git push origin "$BRANCH"
    gh pr create --title "docs: update competitive intelligence report" \
      --body "Auto-generated by scheduled competitive analysis workflow." \
      --base main --head "$BRANCH"
    gh pr merge "$BRANCH" --squash --auto
```

## Relevant Learnings

- **GITHUB_TOKEN cascade:** Commits via GITHUB_TOKEN don't trigger other workflows (security measure). Fine here since we don't need cascading.
- **`--allowedTools` gap:** `claude-code-action` blocks tools by default. The existing workflow already has this configured correctly.
- **Pin actions to SHAs:** All actions in the workflow are already pinned.
- **v1 philosophy was anti-automation:** This is the natural v2 step now that the pattern is proven and the user is requesting it.
